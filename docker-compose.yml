services:
  home-agent:
    build: .
    container_name: home-agent
    ports:
      - "8080:8080"
    volumes:
      # Persist database
      - ./data:/data
    environment:
      - PORT=8080
      - DATABASE_PATH=/data/sessions.db
      # Claude Proxy configuration
      # Set HOST_IP to your server's IP address (e.g., 192.168.1.100)
      - CLAUDE_PROXY_URL=http://${HOST_IP:-host.docker.internal}:9090
      - CLAUDE_PROXY_KEY=${CLAUDE_PROXY_KEY:-}
    # For Linux hosts, add host.docker.internal mapping
    extra_hosts:
      - "host.docker.internal:host-gateway"
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 5s
